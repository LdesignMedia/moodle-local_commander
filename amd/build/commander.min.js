define("local_commander/commander",["exports","core/notification","core/log"],(function(_exports,_notification,_log){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_notification=_interopRequireDefault(_notification),_log=_interopRequireDefault(_log);const KEYS_ESCAPE="Escape",KEYS_ENTER="Enter",KEYS_ARROW_UP="ArrowUp",KEYS_ARROW_DOWN="ArrowDown",commanderAppOptions={courseid:"",keys:[]};const commanderApp={mainModal:null,mainModalBackLayer:null,mainModalCommand:null,liSet:null,isShow:!1,json:null,render(){_log.default.debug("Rendering UI");const modalHtml='\n            <style>\n                :root {\n                    --modal-bg-color: #fff;\n                    --modal-text-color: #000;\n                    --modal-border-color: #ccc;\n                    --highlight-bg-color: #f4bd21;\n                }\n\n                @media (prefers-color-scheme: dark) {\n                    :root {\n                        --modal-bg-color: #2c2c2c;\n                        --modal-text-color: #f0f0f0;\n                        --modal-border-color: #555;\n                        --highlight-bg-color: #f4bd21;\n                    }\n                }\n\n                .local_commander {\n                    position: fixed;\n                    top: 50%;\n                    left: 50%;\n                    transform: translate(-50%, -50%);\n                    background-color: var(--modal-bg-color);\n                    color: var(--modal-text-color);\n                    border: 1px solid var(--modal-border-color);\n                    z-index: 1001;\n                    overflow: hidden;\n                    display: none;\n                    width: 80%;\n                    max-width: 600px;\n                    box-shadow: 0 2px 10px rgba(0,0,0,0.5);\n                }\n\n                .local_commander-header {\n                    padding: 10px;\n                    border-bottom: 1px solid var(--modal-border-color);\n                }\n\n                .local_commander-body {\n                    padding: 10px;\n                }\n\n                .local_commander-body div {\n                    max-height: 300px;\n                    overflow-y: auto;\n                }\n\n                .local_commander ul {\n                    list-style: none;\n                    padding: 0;\n                    margin: 0;\n                }\n\n                .local_commander li {\n                    padding: 5px;\n                    cursor: pointer;\n                }\n\n                .local_commander li.active {\n                    background-color: var(--highlight-bg-color);\n                }\n\n                .local_commander a {\n                    color: inherit;\n                    text-decoration: none;\n                }\n\n                .local_commander input[type="text"] {\n                    width: 100%;\n                    padding: 10px;\n                    border: none;\n                    border-top: 1px solid var(--modal-border-color);\n                    font-size: 16px;\n                    box-sizing: border-box;\n                    background-color: var(--modal-bg-color);\n                    color: var(--modal-text-color);\n                }\n\n                .highlight {\n                    background-color: var(--highlight-bg-color);\n                }\n\n                .local_commander-backdrop {\n                    position: fixed;\n                    top: 0;\n                    left: 0;\n                    width: 100%;\n                    height: 100%;\n                    background-color: rgba(0, 0, 0, 0.5);\n                    z-index: 1000;\n                    display: none;\n                }\n            </style>\n            <div id="local_commander_modal" class="local_commander" role="dialog" aria-modal="true"\n             aria-labelledby="local_commander_header">\n                <div class="local_commander-header">\n                    <h2 id="local_commander_header">'.concat(M.util.get_string("js:header","local_commander"),'</h2>\n                </div>\n                <div class="local_commander-body">\n                    <div><ul></ul></div>\n                </div>\n                <input type="text" name="local_commander_command" id="local_commander_command"\n                 placeholder="').concat(M.util.get_string("js:command_placeholder","local_commander"),'"\n                  aria-label="').concat(M.util.get_string("js:command_placeholder","local_commander"),'">\n            </div>\n            <div id="local_commander_back_layer" class="local_commander-backdrop"></div>\n        ');document.body.insertAdjacentHTML("beforeend",modalHtml),this.mainModal=document.getElementById("local_commander_modal"),this.mainModalBackLayer=document.getElementById("local_commander_back_layer"),this.mainModalCommand=document.getElementById("local_commander_command"),this.addEventListeners(),this.json||this.loadMenu()},start(){window.addEventListener("keydown",(e=>{if(_log.default.debug("Key pressed: ".concat(e.key)),_log.default.debug("Trigger keys: ".concat(commanderAppOptions.keys)),_log.default.debug("Commander is visible: ".concat(this.isShow)),this.isShow)switch(e.key){case KEYS_ESCAPE:this.hide();break;case KEYS_ENTER:e.preventDefault(),this.goToCommand();break;case KEYS_ARROW_UP:e.preventDefault(),this.navigateMenu("up");break;case KEYS_ARROW_DOWN:e.preventDefault(),this.navigateMenu("down")}else if(commanderAppOptions.keys.includes(e.key)){_log.default.debug("Commander keyboard key triggered");const target=e.target,tagName=target.tagName.toUpperCase();if(["INPUT","SELECT","TEXTAREA"].includes(tagName)||target.isContentEditable)return void _log.default.debug("Ignoring keypress in editable element");e.preventDefault(),this.mainModal||this.render(),_log.default.debug("Opening commander"),this.isShow?this.hide():this.show()}}))},addEventListeners(){this.mainModalBackLayer.addEventListener("click",(()=>{this.hide()}));const debouncedSearch=this.debounce((()=>{this.search(this.mainModalCommand.value)}),200);this.mainModalCommand.addEventListener("input",debouncedSearch)},debounce(func,wait){let timeout;return function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];clearTimeout(timeout),timeout=setTimeout((()=>func.apply(this,args)),wait)}},navigateMenu(direction){_log.default.debug("Navigating ".concat(direction));const activeItem=this.mainModal.querySelector("ul li.active");let newItem=null;if(activeItem)for(activeItem.classList.remove("active"),newItem="up"===direction?activeItem.previousElementSibling:activeItem.nextElementSibling;newItem&&"none"===newItem.style.display;)newItem="up"===direction?newItem.previousElementSibling:newItem.nextElementSibling;newItem?newItem.classList.add("active"):activeItem&&activeItem.classList.add("active"),this.scrollToActiveItem()},scrollToActiveItem(){const container=this.mainModal.querySelector(".local_commander-body div"),activeItem=this.mainModal.querySelector("li.active");activeItem&&container&&(container.scrollTop=activeItem.offsetTop-container.offsetTop-10)},goToCommand(){_log.default.debug("Executing command");const activeLink=this.mainModal.querySelector("ul li.active a");if(activeLink){const link=activeLink.getAttribute("href");"#"!==link&&(window.location.href=link)}},async loadMenu(){try{const response=await fetch("".concat(M.cfg.wwwroot,"/local/commander/ajax.php?courseid=").concat(commanderAppOptions.courseid),{method:"GET",credentials:"same-origin"});if(!response.ok)throw new Error("Network response was not ok");this.json=await response.json(),_log.default.debug(this.json),this.setMenu()}catch(error){_log.default.error(error),_notification.default.alert(M.util.get_string("js:error_parsing","local_commander"))}},search(query){const searchTerm=query.trim().toUpperCase(),listItems=Array.from(this.liSet);if(listItems.forEach((li=>{this.removeHighlight(li),li.style.display="",li.classList.remove("active")})),""===searchTerm)return;let firstMatch=null;listItems.forEach((li=>{li.textContent.toUpperCase().includes(searchTerm)?(this.highlightWord(li,searchTerm),firstMatch||(firstMatch=li)):li.style.display="none"})),firstMatch&&(firstMatch.classList.add("active"),this.scrollToActiveItem())},highlightWord(element,word){const regex=new RegExp("(".concat(word.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),")"),"gi");element.innerHTML=element.innerHTML.replace(regex,'<span class="highlight">$1</span>')},removeHighlight(element){element.innerHTML=element.textContent},setMenu(){_log.default.debug("Setting up menu");let html="";commanderAppOptions.courseid>0&&this.json.courseadmin&&(_log.default.debug("Including course administration menu"),html+=this.renderMenuItems(this.json.courseadmin,"")),this.json.admin&&(html+=this.renderMenuItems(this.json.admin,""));this.mainModal.querySelector(".local_commander-body ul").innerHTML=html,this.liSet=this.mainModal.querySelectorAll(".local_commander-body ul li")},renderMenuItems(item,parentName){if(!item.name)return"";let html="";const fullName=parentName?"".concat(parentName," â†’ ").concat(item.name):item.name;return html+='<li><a href="'.concat(item.link,'">').concat(fullName,"</a></li>"),item.haschildren&&item.children&&item.children.forEach((child=>{html+=this.renderMenuItems(child,fullName)})),html},show(){this.mainModal.style.display="block",this.mainModalBackLayer.style.display="block",this.isShow=!0,this.mainModalCommand.focus()},hide(){this.mainModal.style.display="none",this.mainModalBackLayer.style.display="none",this.isShow=!1,this.mainModalCommand.value="",this.search("")}};var _default={init:function(params){var options;options=params,Object.keys(commanderAppOptions).forEach((key=>{options.hasOwnProperty(key)&&(commanderAppOptions[key]=options[key])})),_log.default.debug("DOM fully loaded - initializing commanderApp"),_log.default.debug(commanderAppOptions),commanderApp.start()}};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=commander.min.js.map