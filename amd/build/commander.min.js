function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("local_commander/commander",["jquery","core/notification"],function(a,b){'use strict';a.fn.scrollTo=function(b,c){a(this).stop().animate({scrollTop:a(this).scrollTop()-a(this).offset().top+a(b).offset().top-10},c==void 0?1e3:c);return this};var c={courseid:"",keys:[]},d=function(a){var b,d;for(b in c){if(c.hasOwnProperty(b)&&a.hasOwnProperty(b)){d=_typeof(c[b]);if("boolean"===d){c[b]=!!a[b]}else if("number"===d){c[b]=+a[b]}else if("string"===d){c[b]=a[b]+""}else{c[b]=a[b]}}}},f={$mainModal:!1,$mainModalBackLayer:!1,$mainModalCommand:!1,$liSet:!1,isShow:!1,json:"",log:function log(){try{console.log.apply(console,arguments)}catch(a){throw a}},render:function render(){var b=0;f.log("render UI");a("body").append("<div id=\"local_commander_modal\" class=\"local_commander\"><div class=\"local_commander-header\"><h2>"+M.util.get_string("js:header","local_commander")+"</h2></div><div class=\"local_commander-body\"></div><input type=\"text\" name=\"local_commander_command\" id=\"local_commander_command\" placeholder=\""+M.util.get_string("js:command_placeholder","local_commander")+"\"></div><div id=\"local_commander_back_layer\"></div>");f.$mainModal=a("#local_commander_modal");f.$mainModalBackLayer=a("#local_commander_back_layer");f.$mainModalCommand=a("#local_commander_command");f.setHeight();f.$mainModalBackLayer.on("click",function(){f.hide()});f.$mainModalCommand.on("keydown",function(a){var c=a.keyCode||a.which;f.log("Code pressed:",c);switch(c){case 27:case 13:case 38:case 40:return;}f.log("Searching");clearTimeout(b);b=setTimeout(function(){f.search(f.$mainModalCommand.val())},100)});if(""===f.json){f.loadMenu()}},start:function start(){f.$mainModal=a("#local_commander_modal");a(window).on("keydown",function(a){var b=a.keyCode||a.which;f.log("Code pressed:",b);f.log("Trigger keys:",c.keys);f.log("Commander is visible:",f.isShow);if(f.isShow){switch(b){case 27:f.hide();break;case 13:a.preventDefault();f.goToCommand();break;case 38:a.preventDefault();f.arrowUp();break;case 40:a.preventDefault();f.arrowDown();break;}return}if(-1!==c.keys.indexOf(b.toString())){f.log("Commander keyboard key triggered");if("INPUT"==a.target.tagName||"SELECT"==a.target.tagName||"TEXTAREA"==a.target.tagName||a.target.isContentEditable){f.log("Hide when we are in an editable element");return}a.preventDefault();if(0==f.$mainModal.length){f.render()}f.log("Open commander.");if(f.isShow){f.hide()}else{f.show()}}})},highlightWord:function highlightWord(a,b){if(3==a.nodeType){var c=a.data.toUpperCase().indexOf(b);if(0<=c){var d=document.createElement("span");d.className="highlight";d.style.backgroundColor="#f4bd21";var e=a.splitText(c),g=e.cloneNode(!0);d.appendChild(g);e.parentNode.replaceChild(d,e)}}else if(1==a.nodeType&&a.childNodes){for(var h=0;h<a.childNodes.length;++h){h+=f.highlightWord(a.childNodes[h],b)}}},arrowUp:function arrowUp(){f.log("arrowUp");var b=a("#local_commander_modal ul li.active"),c=b.closest("li").prevAll("li:visible").eq(0);if(b.length){b.removeClass("active")}if(c.length){c.addClass("active")}else{b.addClass("active")}f.scrollTo()},arrowDown:function arrowDown(){f.log("arrowDown");var b=a("#local_commander_modal ul li.active"),c=b.closest("li").nextAll("li:visible").eq(0);if(b.length){b.removeClass("active")}if(c.length){c.addClass("active")}else{a("#local_commander_modal ul li:visible").last().addClass("active")}f.scrollTo()},scrollTo:function scrollTo(){a("#local_commander_modal .local_commander-body div").scrollTo("#local_commander_modal li.active",200)},goToCommand:function goToCommand(){f.log("goToCommand");var b=a("#local_commander_modal ul li.active a");if(b){var c=b.attr("href");if("#"!=c){window.location=c}}},loadMenu:function loadMenu(){a.ajax({url:M.cfg.wwwroot+"/local/commander/ajax.php",method:"GET",data:{courseid:c.courseid},dataType:"json"}).done(function(a){f.log(a);f.json=a;f.setMenu();f.setHeight()}).fail(function(){b.alert("js:error_parsing","local_commander")})},search:function search(b){a(".local_commander-body ul li").show();f.$liSet.find("li.active").removeClass("active");f.$liSet.find("span.highlight").each(function(){f.removeHighlight(this.parentNode)});if(""!==b){f.$liSet.children().each(function(){f.highlightWord(this,b.toUpperCase())});a(".local_commander-body span.highlight").first().parent().parent().addClass("active");a(".local_commander-body ul li:not(:has(span))").hide()}},setMenu:function setMenu(){f.log("setMenu() ");var b="<div><ul>";if(0<c.courseid){f.log("Has course param.");b+=f.renderMenuItems(f.json.courseadmin,1)}b+=f.renderMenuItems(f.json.admin,1);b+="</ul></div>";f.$mainModal.find(".local_commander-body").append(b);f.$liSet=a(".local_commander-body ul")},renderMenuItems:function renderMenuItems(b,c,d){var e="";if(!b.name){return e}if(!d){d=""}else{d+=" &rarr; "}e+="<li>";if(b.name){e+="<a href=\""+b.link+"\">"+d+b.name+"</a>"}if(b.haschildren){a.each(b.children,function(a,g){e+=f.renderMenuItems(g,c+1,d+b.name)})}e+="</li>";return e},show:function show(){f.$mainModal.show();f.$mainModalBackLayer.show();f.isShow=!0;f.$mainModalCommand.focus()},hide:function hide(){f.$mainModal.hide();f.$mainModalBackLayer.hide();f.isShow=!1},setHeight:function setHeight(){var b=Math.round(a(window).height()/2);f.$mainModal.height(b);a(".local_commander-body div").height(b-100)},removeHighlight:function removeHighlight(b){a(b).html(a(b).text())}};return{init:function init(b){d(b);a(document).ready(function(){f.log("ready() - local commander v3.82",c);f.start()})}}});
//# sourceMappingURL=commander.min.js.map
