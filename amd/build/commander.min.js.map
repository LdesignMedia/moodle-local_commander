{"version":3,"sources":["../src/commander.js"],"names":["define","$","notification","fn","scrollTo","elem","speed","stop","animate","scrollTop","offset","top","commanderAppOptions","courseid","keys","setOptions","options","key","vartype","hasOwnProperty","commanderApp","$mainModal","$mainModalBackLayer","$mainModalCommand","$liSet","isShow","json","log","console","apply","arguments","exc","render","timer","append","M","util","get_string","setHeight","on","hide","e","keyboardCode","code","toLowerCase","clearTimeout","setTimeout","search","val","loadMenu","start","window","preventDefault","goToCommand","arrowUp","arrowDown","indexOf","target","tagName","isContentEditable","length","show","highlightWord","node","word","nodeType","pos","data","toUpperCase","spannode","document","createElement","className","style","backgroundColor","middlebit","splitText","middleclone","cloneNode","appendChild","parentNode","replaceChild","childNodes","i","$el","$prev","closest","prevAll","eq","removeClass","addClass","$next","nextAll","last","link","attr","location","ajax","url","cfg","wwwroot","method","dataType","done","response","setMenu","fail","alert","find","each","removeHighlight","children","first","parent","html","renderMenuItems","courseadmin","admin","child","depth","parentName","name","haschildren","el","focus","height","Math","round","text","init","params","ready"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JS to show the popup and interact with it.\n *\n *\n * Tested in Moodle 3.8\n *\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n *\n * @package local_commander\n * @copyright 2018 MFreak.nl\n * @author    Luuk Verhoeven\n **/\n/* eslint no-console: [\"error\", { allow: [\"warn\", \"error\" , \"log\"] }] */\n/* eslint-disable no-invalid-this */\ndefine(['jquery', 'core/notification'], function($, notification) {\n    'use strict';\n\n    // Fix scrolling.\n    $.fn.scrollTo = function(elem, speed) {\n        $(this).stop().animate({\n            scrollTop: $(this).scrollTop() - $(this).offset().top + $(elem).offset().top - 10\n        }, speed == undefined ? 1000 : speed);\n        return this;\n    };\n\n    /**\n     * Options we can set from amd.\n     * @type {{selector: string, blockid: number}}\n     */\n    var commanderAppOptions = {\n        courseid: '',\n        keys: [],\n    };\n\n    /**\n     * Set options base on listed options\n     * @param {object} options\n     */\n    var setOptions = function(options) {\n        \"use strict\";\n        var key, vartype;\n        for (key in commanderAppOptions) {\n            if (commanderAppOptions.hasOwnProperty(key) && options.hasOwnProperty(key)) {\n\n                // Casting to prevent errors.\n                vartype = typeof commanderAppOptions[key];\n                if (vartype === \"boolean\") {\n                    commanderAppOptions[key] = Boolean(options[key]);\n                } else if (vartype === 'number') {\n                    commanderAppOptions[key] = Number(options[key]);\n                } else if (vartype === 'string') {\n                    commanderAppOptions[key] = String(options[key]);\n                } else {\n                    commanderAppOptions[key] = options[key];\n                }\n            }\n        }\n    };\n\n    /**\n     * Commander plugin.\n     * @type {{}}\n     */\n    var commanderApp = {\n\n        /**\n         * Modal jQuery element instance.\n         */\n        $mainModal: false,\n\n        /**\n         * Modal BG jQuery element instance.\n         */\n        $mainModalBackLayer: false,\n\n        /**\n         * Input field\n         */\n        $mainModalCommand: false,\n\n        /**\n         * Stores all li elements\n         */\n        $liSet: false,\n\n        /**\n         * Flag to check if modal is open.\n         */\n        isShow: false,\n\n        /**\n         * Save response\n         */\n        json: '',\n\n        /**\n         * Internal logging\n         * @param {*} val\n         */\n        log: function() {\n            \"use strict\";\n\n            // Check if we can show the log.\n            try {\n                // TODO Only show if debugging enabled in cfg.\n                console.log.apply(console, arguments);\n            } catch (exc) {\n                throw exc;\n            }\n        },\n\n        /**\n         * Render UI.\n         */\n        render: function() {\n            \"use strict\";\n            var timer = 0;\n            commanderApp.log('render UI');\n\n            // @TODO we should use mustache.\n            $('body').append('<div id=\"local_commander_modal\" class=\"local_commander\">' +\n                '<div class=\"local_commander-header\"><h2>' + M.util.get_string('js:header', 'local_commander') + '</h2></div>' +\n                '<div class=\"local_commander-body\">' +\n                '</div>' +\n                '<input type=\"text\" name=\"local_commander_command\" id=\"local_commander_command\" placeholder=\"' +\n                M.util.get_string('js:command_placeholder', 'local_commander') + '\">' +\n                '</div><div id=\"local_commander_back_layer\"></div>');\n\n            // Set references.\n            commanderApp.$mainModal = $('#local_commander_modal');\n            commanderApp.$mainModalBackLayer = $('#local_commander_back_layer');\n            commanderApp.$mainModalCommand = $('#local_commander_command');\n\n            commanderApp.setHeight();\n\n            commanderApp.$mainModalBackLayer.on('click', function() {\n                commanderApp.hide();\n            });\n\n            // Search set some timeout optimize speed.\n            commanderApp.$mainModalCommand.on('keydown', function(e) {\n                var keyboardCode = e.code.toLowerCase();\n\n                switch (keyboardCode) {\n                    case 'escape':\n                    case 'enter':\n                    case 'arrowup':\n                    case 'arrowdown':\n                        return;\n                }\n\n                commanderApp.log('Searching');\n\n                clearTimeout(timer);\n                timer = setTimeout(function() {\n                    commanderApp.search(commanderApp.$mainModalCommand.val());\n                }, 100);\n            });\n\n            // Loading the menu content once.\n            if (commanderApp.json === '') {\n                commanderApp.loadMenu();\n            }\n        },\n\n        /**\n         * Start the commander.\n         */\n        start: function() {\n            // Set holders.\n            commanderApp.$mainModal = $('#local_commander_modal');\n\n            $(window).on('keydown', function(e) {\n                var keyboardCode = e.code.toLowerCase();\n                commanderApp.log('Pressed:', keyboardCode);\n                commanderApp.log('Show:', commanderApp.isShow);\n\n                // Check for arrow keys.\n                if (commanderApp.isShow) {\n                    switch (keyboardCode) {\n                        case 'escape':\n                            commanderApp.hide();\n                            break;\n\n                        case 'enter':\n                            e.preventDefault();\n                            commanderApp.goToCommand();\n                            break;\n\n                        case 'arrowup':\n                            e.preventDefault();\n                            commanderApp.arrowUp();\n                            break;\n\n                        case 'arrowdown':\n                            e.preventDefault();\n                            commanderApp.arrowDown();\n                            break;\n                    }\n                    return;\n                }\n\n                if (commanderAppOptions.keys.indexOf(keyboardCode) !== -1) {\n                    e.preventDefault();\n                    commanderApp.log('Commander keyboard key triggered');\n\n                    // Validate we not triggered in an editable area.\n                    if (e.target.tagName == 'INPUT' || e.target.tagName == 'SELECT'\n                        || e.target.tagName == 'TEXTAREA' || e.target.isContentEditable) {\n                        commanderApp.log('Hide when we are in an editable element');\n                        return;\n                    }\n\n                    // Only render if needed.\n                    if (commanderApp.$mainModal.length == 0) {\n                        commanderApp.render();\n                    }\n\n                    commanderApp.log('Open commander.');\n\n                    if (commanderApp.isShow) {\n                        commanderApp.hide();\n                    } else {\n                        commanderApp.show();\n                    }\n                }\n            });\n        },\n\n        /**\n         * Highlight words\n         *\n         * @param {object} node\n         * @param {string} word\n         */\n        highlightWord: function(node, word) {\n            if (node.nodeType == 3) {\n                var pos = node.data.toUpperCase().indexOf(word);\n                if (pos >= 0) {\n                    var spannode = document.createElement('span');\n                    spannode.className = 'highlight';\n                    spannode.style.backgroundColor = '#f4bd21';\n                    var middlebit = node.splitText(pos);\n                    var middleclone = middlebit.cloneNode(true);\n                    spannode.appendChild(middleclone);\n                    middlebit.parentNode.replaceChild(spannode, middlebit);\n                }\n\n            } else if (node.nodeType == 1 && node.childNodes) {\n                for (var i = 0; i < node.childNodes.length; ++i) {\n                    i += commanderApp.highlightWord(node.childNodes[i], word);\n                }\n            }\n        },\n\n        /**\n         * Action on keyboard arrow key UP.\n         */\n        arrowUp: function() {\n            commanderApp.log('arrowUp');\n            var $el = $('#local_commander_modal ul li.active'),\n                $prev = $el.closest(\"li\").prevAll(\"li:visible\").eq(0);\n\n            if ($el.length) {\n                $el.removeClass('active');\n            }\n\n            if ($prev.length) {\n                $prev.addClass('active');\n            } else {\n                $el.addClass('active');\n            }\n\n            //\n            commanderApp.scrollTo();\n        },\n\n        /**\n         * Action on keyboard arrow key DOWN.\n         */\n        arrowDown: function() {\n            commanderApp.log('arrowDown');\n            var $el = $('#local_commander_modal ul li.active'),\n                $next = $el.closest(\"li\").nextAll(\"li:visible\").eq(0);\n\n            if ($el.length) {\n                $el.removeClass('active');\n            }\n            if ($next.length) {\n                $next.addClass('active');\n            } else {\n                $('#local_commander_modal ul li:visible').last().addClass('active');\n            }\n            //\n            commanderApp.scrollTo();\n        },\n\n        /**\n         * Scroll to active item.\n         */\n        scrollTo: function() {\n            $('#local_commander_modal .local_commander-body div').scrollTo('#local_commander_modal li.active', 200);\n        },\n\n        /**\n         * The command that we need to execute.\n         */\n        goToCommand: function() {\n            commanderApp.log('goToCommand');\n            // Check if there is a element selected.\n            // Check if the element has link.\n            // TODO maybe add way to execute other type of commands.\n            var $el = $('#local_commander_modal ul li.active a');\n            if ($el) {\n                var link = $el.attr('href');\n                if (link != '#') {\n                    window.location = link;\n                }\n            }\n        },\n\n        /**\n         * Load menu\n         */\n        loadMenu: function() {\n            \"use strict\";\n\n            $.ajax({\n                url: M.cfg.wwwroot + '/local/commander/ajax.php',\n                method: \"GET\",\n                data: {\n                    'courseid': commanderAppOptions.courseid\n                },\n                dataType: \"json\",\n            }).done(function(response) {\n                commanderApp.log(response);\n                commanderApp.json = response;\n\n                commanderApp.setMenu();\n                commanderApp.setHeight();\n            }).fail(function() {\n                notification.alert('js:error_parsing', 'local_commander');\n            });\n        },\n\n        /**\n         * Search in the commands.\n         * @param {string} word\n         */\n        search: function(word) {\n            \"use strict\";\n\n            // Remove active.\n            $('.local_commander-body ul li').show();\n            commanderApp.$liSet.find('li.active').removeClass('active');\n\n            // Remove highlights.\n            commanderApp.$liSet.find(\"span.highlight\").each(function() {\n                commanderApp.removeHighlight(this.parentNode);\n            });\n\n            if (word !== '') {\n\n                commanderApp.$liSet.children().each(function() {\n                    commanderApp.highlightWord(this, word.toUpperCase());\n                });\n\n                // Set active li item.\n                $('.local_commander-body span.highlight').first().parent().parent().addClass('active');\n\n                // Hide others.\n                $('.local_commander-body ul li:not(:has(span))').hide();\n            }\n        },\n\n        /**\n         * Build the ul command list.\n         */\n        setMenu: function() {\n            \"use strict\";\n            commanderApp.log('setMenu() ');\n\n            var html = '<div><ul>';\n\n            // Only do things when needed.\n            if (commanderAppOptions.courseid > 0) {\n                commanderApp.log('Has course param.');\n                html += commanderApp.renderMenuItems(commanderApp.json.courseadmin, 1);\n            }\n\n            // Always try adding admin menu.\n            html += commanderApp.renderMenuItems(commanderApp.json.admin, 1);\n\n            html += '</ul></div>';\n            commanderApp.$mainModal.find('.local_commander-body').append(html);\n\n            commanderApp.$liSet = $('.local_commander-body ul');\n        },\n\n        /**\n         * Render items and add the correct attr.\n         *\n         * @param {object} child\n         * @param {int} depth\n         * @param {string} parentName\n         *\n         * @returns {string}\n         */\n        renderMenuItems: function(child, depth, parentName) {\n            \"use strict\";\n            var html = '';\n\n            // Check child.\n            if (!child.name) {\n                return html;\n            }\n\n            // Set parentName.\n            if (!parentName) {\n                parentName = '';\n            } else {\n                parentName += ' &rarr; ';\n            }\n\n            html += '<li>';\n\n            if (child.name) {\n                // Add the same to buffer.\n                //\n                html += '<a href=\"' + child.link + '\">' + parentName + child.name + '</a>';\n            }\n\n            if (child.haschildren) {\n                $.each(child.children, function(i, el) {\n                    html += commanderApp.renderMenuItems(el, depth + 1, parentName + child.name);\n                });\n            }\n\n            html += '</li>';\n            return html;\n        },\n\n        /**\n         * Show the modal\n         */\n        show: function() {\n            \"use strict\";\n            commanderApp.$mainModal.show();\n            commanderApp.$mainModalBackLayer.show();\n\n            commanderApp.isShow = true;\n\n            // Focus on search field.\n            commanderApp.$mainModalCommand.focus();\n        },\n\n        /**\n         * Hide the modal\n         */\n        hide: function() {\n            commanderApp.$mainModal.hide();\n            commanderApp.$mainModalBackLayer.hide();\n\n            commanderApp.isShow = false;\n        },\n\n        /**\n         * Set 50% of viewport height\n         */\n        setHeight: function() {\n            var height = Math.round($(window).height() / 2);\n            commanderApp.$mainModal.height(height);\n            $('.local_commander-body div').height(height - 100);\n        },\n\n        /**\n         * Remove highlight\n         * @param {object} node\n         */\n        removeHighlight: function(node) {\n            $(node).html($(node).text());\n        }\n    };\n\n    return {\n\n        /**\n         * Called from Moodle.\n         * @param {array} params\n         */\n        init: function(params) {\n\n            /**\n             * Set the options.\n             */\n            setOptions(params);\n\n            /**\n             * Wait for jQuery\n             */\n            $(document).ready(function() {\n                commanderApp.log('ready() - local commander v3.80', commanderAppOptions);\n                commanderApp.start();\n            });\n        }\n    };\n});"],"file":"commander.min.js"}